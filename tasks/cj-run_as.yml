---
- name: "Add user group"
  group:
    name: "{{ jenkins_runas_group | d('jenkins')}}"
  when: jenkins_runas_group != 'jenkins'

- name: "Add user user"
  user:
    name: "{{ jenkins_runas_user | d('jenkins')}}"
    group: "{{ jenkins_runas_group | d('jenkins')}}"
  when: jenkins_runas_user != 'jenkins'

- name: "Configure user user as sudoer"
  template:
    src: sudoer.j2
    dest: "/etc/sudoers.d/{{ jenkins_runas_user | d('jenkins')}}"
    mode: 0644
    owner: root
    group: root
  when: (jenkins_runas_sudoer is defined) and (jenkins_runas_sudoer | bool)

# we only need this task if user != jenkins ...
- name: "Set permissions"
  file:
    path: "{{ item }}"
    recurse: yes
    state: directory
    owner: "{{ jenkins_runas_user | d('jenkins')}}"
    group: "{{ jenkins_runas_group | d('jenkins')}}"
  with_items:
  - "{{ jenkins_home }}"
  - "{{ jenkins_log_dir }}"
  - "{{ jenkins_cache_dir }}"
